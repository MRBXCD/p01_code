# EXP_2024.11.1.3
### Problem Formulation
**A**: 8 view raw reconstruction voxel\
**B**: 16 view CB projection of **A**\
**C**: Reconstructed voxel based on **B**\
**D**: Output 16 view CB projection sequence from 8-16 DL model\
**E**: 16 view raw CB projection sequence

# EXP_1.py

## 用途
这段代码的主要用途是：
1. **随机抽样**：
   - 从两个 `.npz` 文件中加载包含多维图像数据的数组，并随机挑选指定数量的样本。
2. **分布筛选与比较**：
   - 筛选像素强度不超过指定阈值的像素，忽略高强度值对分布的影响。
   - 比较两个样本的像素值分布，计算 Wasserstein 距离和互信息以衡量差异。
3. **分布可视化**：
   - 绘制像素值分布的直方图，直观展示两个样本的分布差异。

---

## 适用场景
- 适用于需要对图像样本进行分布特性分析的场景，例如医学影像分析、图像增强评估或图像数据的统计研究。
- 针对高强度像素的影响，通过设置强度阈值，专注于某一范围内的像素分布。
- 可用于深度学习或图像处理相关任务中的数据探索。

---

## 功能说明
1. **随机抽样**：
   - 从输入的两个 `.npz` 文件中，分别随机抽取指定数量的样本。
   - 样本结构为 4 维数组，形状为 `(N, H, W, D)`，即样本数、图像高度、宽度和深度。
   
2. **像素筛选**：
   - 将样本中的所有投影平铺为一维数组，并筛选像素强度小于或等于指定阈值（默认 20）的像素。

3. **分布计算**：
   - 使用直方图统计像素强度的分布（归一化为概率密度）。
   - 计算以下两个指标：
     - **Wasserstein 距离**：衡量两个分布的累积差异，越小表示分布越接近。
     - **互信息 (Mutual Information)**：衡量两个分布的相关性，值越大表示分布更相关。

4. **分布可视化**：
   - 绘制两个样本的像素值归一化分布直方图，方便直观比较分布差异。

---

## 输入
- **file_path1**: 第一个 `.npz` 文件的路径，包含样本数据。
- **file_path2**: 第二个 `.npz` 文件的路径，包含样本数据。
- **sample_size**: 随机抽取的样本数量（默认为 50）。
- **intensity_threshold**: 像素强度阈值，仅考虑小于或等于该值的像素（默认为 20）。

---

## 输出
1. **打印结果**：
   - Wasserstein 距离：两个样本分布的累积差异。
   - 互信息：两个样本分布的相关性。
   
2. **图形输出**：
   - 两个样本的像素值归一化分布直方图。

---

## 代码示例
以下是代码的典型使用方式：
```python
file_path1 = "/path/to/file1.npz"  # 替换为实际文件路径
file_path2 = "/path/to/file2.npz"  # 替换为实际文件路径

random_sample_and_compare(
    file_path1=file_path1,
    file_path2=file_path2,
    sample_size=50,
    intensity_threshold=20
)
```
## 结论
深度学习得到的预测曲线和原始体素反投影曲线的分布很类似，区别不大
